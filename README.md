
# Payment System

This is a simple Payment System built with Spring Boot and PostgreSQL. The system allows for CRUD operations on payments and integrates with PostgreSQL for data persistence. The project uses Flyway for database migrations and HikariCP for database connection pooling.

## Technologies Used

- **Spring Boot**: Framework used to build the backend service.
- **PostgreSQL**: Relational database used to store payment data.
- **Flyway**: Used for database versioning and migrations.
- **HikariCP**: Connection pooling used for managing PostgreSQL connections.
- **JUnit**: Testing framework used for writing unit and integration tests.
- **Mockito**: Used for mocking dependencies in the tests.
- **Lombok**: Used to reduce boilerplate code in Java classes.

## Prerequisites

Before running the application, make sure you have the following installed:

- **Java 17** or higher
- **Maven**
- **Docker**

## Project Structure

```
src
 ├── main
 │    ├── java
 │    │    ├── com
 │    │    │    ├── example
 │    │    │    │    ├── prommtdemo
 │    │    │    │    │    ├── controller
 │    │    │    │    │    ├── cors
 │    │    │    │    │    ├── entity
 │    │    │    │    │    ├── enums
 │    │    │    │    │    ├── exception
 │    │    │    │    │    ├── repository
 │    │    │    │    │    ├── service
 │    │    ├── resources
 │    │    │    ├── application.yml
 │    │    │    ├── db
 │    │    │    │    ├── migration
 │    │    │    │    │    ├── V1__create_payment_table.sql
 │    │    │    ├── application.yml
 └── test
      ├── java
      │    ├── com
      │    │    ├── example
      │    │    │    ├── prommtdemo
      │    │    │    │    ├── controller
      │    │    │    │    ├── repository
      │    │    │    │    ├── service
      │    ├── resources
      │    │    ├── application.yml
      │    │    ├── logback-test.xml
      └──
```

## How to Deploy

### 1. Build and Run the Application

To build and run the application, use the following commands:

Build:

```bash
./mvnw clean package -Ddocker-image.tag=latest
```

Deploy

```bash
docker-compose up
```

To undeploy the application, use the following command:

```bash
docker-compose down
```

## Accessing the PostgreSQL Database

If you're using Docker for PostgreSQL, you can access the database by connecting to the container:

```bash
PGPASSWORD=prommt-postgres psql -U prommt-postgres -p 5432 -h localhost -d prommt-postgres
```

### Database Table Structure

The following table structure is used to store the payment data:

#### `prommt_payment` Table

| Column Name     | Data Type              | Description                                      |
|-----------------|------------------------|--------------------------------------------------|
| `id`            | `BIGINT`               | Primary key, auto-generated by the sequence.     |
| `payer_email`   | `VARCHAR(255)`          | Email of the payer (cannot be null).             |
| `status`        | `VARCHAR(50)`           | Status of the payment (e.g., "PENDING", "COMPLETED"). |
| `currency`      | `VARCHAR(10)`           | Currency used for the payment (e.g., USD).       |
| `amount`        | `NUMERIC(19, 4)`        | Amount of the payment (with 4 decimal places).   |
| `created_date`  | `TIMESTAMP`             | Date when the payment was created.               |
| `paid_date`     | `TIMESTAMP`             | Date when the payment was completed.             |

The `id` column is auto-incremented via the `prommt_payment_seq` sequence.

## Endpoints

### 1. **GET /api/v1/payment**: Get all payments
   - Returns a list of all payments.

### 2. **GET /api/v1/payment/{id}**: Get payment by ID
   - Fetches the details of a payment by its `id`.

### 3. **POST /api/v1/payment**: Create a new payment
   - Creates a new payment with the provided data in the request body.

### 4. **PUT /api/v1/payment/{id}**: Update an existing payment
   - Updates the payment with the given `id`.

### 5. **DELETE /api/v1/payment/{id}**: Delete a payment
   - Deletes the payment with the specified `id`.

## Running Tests

To run tests for the application, use the following Maven command:

```bash
./mvnw test
```

This will execute unit and integration tests for the application.

## Conclusion

This project provides a basic payment system that can be extended to suit various use cases. You can manage payments via RESTful endpoints, with data persistence powered by PostgreSQL and Flyway migrations.
